#summary The general logic of the server
#labels Design

= Server General Logic =

Here is how it works.

  * It is known that the only way to modify the gamestate is through 'actions'.
  * The server receives an action from HTTP. In order to identify the context of the action, each action ships with a respective Game ID (can be omitted when the action is not specific-game related) and User ID (mandatory).
  * The server parses, validates and dispatches the action to the corresponding logic, mapping it to a class member function and passing it any extra parameters that were given through the request.
  * The action-mapped function gets called by the dispatcher, returning a value of whether or not the action went smoothly.
  * The dispatcher logs the action along with its resulting status and gives the action result back to the requester.

This model allows extensibility to cover any other turn-based game. It is apparent that there is no Monopoly-specific point anywhere in the list.


= Request / Response Flow =

It should be pointed out that the flow of requests and responses are asynchronous. As a response to an action request the server sends only whether or not the action went fine, and if not fine - what the problem was. The gamestate changes are tracked by the clients separately. The client which initiated the action, however, knows there is a gamestate change data to receive when it gets a positive response for its action.

Each gamestate change action is tracked with an automatically incrementing unique identifier, within the context of the game. Each client participating in the game can request all gamestate change actions after any action ID they need. This makes it simple for the clients to load the saved games, tracking the changes from the beginning to the current state.



For example (> = Action Request, < = Action Response):

  * > turn
  * < ok

-/ asynchronously /-

  * > getState(4)   // get whatever happened after the 4th gamestate action
  * < xml array of the gamestate changes that occured (not drafted yet)